<div class="container mx-auto px-1 py-1 md:p-4 space-y-6">
    <div class="flex items-center px-3 py-4 gap-5 rounded-md bg-[#f2f0fe]">
        <img class="size-32" src="lock-in-the-clouds.svg" alt="">
        <div class="flex  flex-col space-y-1">
            <span class="text-[15px] text-gray-600">
                Access to this project is currently Open. To customize user access, such as roles and permissions,
                upgrade your plan to Standard.
            </span>
            <span class="text-xs text-blue-500">
                Learn more about managing access</span>
        </div>
    </div>
    <!-- Workspace Members Section -->
    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <div class=" px-4 py-3 border-b border-gray-200">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-[#4e81ed] rounded-md flex items-center justify-center text-white">
                    <i class='bx bx-group text-lg'></i>
                </div>
                <h1 class="text-xl font-semibold text-black">Workspace Members</h1>
            </div>
            <p class="text-xs text-gray-600 mt-1">Workspace members can view and join all Workspace projects, tasks and
                create new tasks in the Workspace</p>
        </div>
        <div class="p-4">
            <div class="bg-[#fbfafa] p-3 rounded-md mb-4">
                <h3 class="text-[15px] font-medium text-black mb-2">Invite members to join you</h3>
                <p class="text-xs text-gray-600 mb-3">Anyone with invite link can join this free Workspace</p>
                <div
                    class="flex items-center justify-center border border-gray-200 px-3 py-2 bg-white rounded-lg w-full  mb-2 space-x-2">
                    <!-- Email Input Section -->
                    <div class="flex w-1/2 items-center space-x-2">
                        <input type="email" [(ngModel)]="newMemberEmail" placeholder="Enter email address"
                            class="flex-1 text-sm px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>

                    <!-- Project Selection Dropdown -->
                    <div class="dropdown-container relative flex-1 ">
                        <button type="button" (click)="toggleDropdown()"
                            class="w-full px-4 py-2 text-sm bg-gray-50 border-l-2 border-r-2 border-gray-200 border-dashed text-gray-700 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-200 flex items-center justify-between">
                            <span class="truncate">{{ getSelectedProjectsText() }}</span>
                            <svg class="w-4 h-4 ml-2 transition-transform duration-200"
                                [class.rotate-180]="isDropdownOpen" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>

                        <!-- Dropdown Menu -->
                        <div *ngIf="isDropdownOpen"
                            class="absolute top-full left-0 right-0 my-1 bg-white border border-gray-200 rounded-md shadow-lg z-50 max-h-60 overflow-y-auto">
                            <div class="py-1">
                                <div *ngFor="let project of availableProjects"
                                    class="px-4 py-2 text-sm hover:bg-gray-100 cursor-pointer flex items-center space-x-2"
                                    (click)="toggleProjectSelection(project)">
                                    <input type="checkbox" [checked]="isProjectSelected(project)"
                                        class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"
                                        readonly>
                                    <span class="flex-1 truncate">{{ project.name }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Invite Button -->
                    <button (click)="sendInvite()"
                        [disabled]="!isValidEmail(newMemberEmail) || selectedProjects.length === 0"
                        class="text-sm flex items-center px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 min-w-max">
                        <div class="flex items-center gap-2" *ngIf="!isLoading">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            <span>Invite</span>
                        </div>

                        <!-- Loading Spinner -->
                        <div *ngIf="isLoading" class="flex items-center gap-2">
                            <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent">
                            </div>
                            <span>Sending...</span>
                        </div>
                    </button>
                </div>

                <!-- Selected Projects Display (Optional) -->
                <div *ngIf="selectedProjects.length > 0" class="mt-2 mb-3 flex flex-wrap gap-1">
                    <span *ngFor="let project of selectedProjects"
                        class="inline-flex items-center px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full">
                        {{ project.name }}
                        <button (click)="toggleProjectSelection(project)"
                            class="ml-1 text-purple-600 hover:text-purple-800">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </span>
                </div>
                <!-- Workspace Members List -->
                <div class="space-y-3 border-t border-gray-200">
                    <div *ngFor="let member of members; trackBy: trackByMemberId"
                        class="flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0">
                        <div class="flex items-center space-x-3">
                            <img [src]="(member.image | memberImage )" [alt]="member.fullName"
                                class="w-10 h-10 rounded-full border border-gray-200">
                            <div class="flex flex-col">
                                <span class="text-xs font-medium text-black">{{ member.fullName }}</span>
                                <span class="text-xs text-gray-500">{{ member.email }}</span>
                            </div>
                        </div>

                        <div class="flex items-center space-x-2">
                           <div class="inline-flex font-semibold items-center px-4 py-1 text-xs bg-purple-100 text-purple-800 rounded-full">{{ member.role }}</div>
                            <button
                                class="text-xs px-2 py-1 text-gray-500 border border-gray-200 rounded hover:bg-gray-50 hover:text-gray-700">
                                <i class='bx bx-trash'></i>
                            </button>
                             <button
                                class="text-xs px-2 py-1 text-gray-500 border border-gray-200 rounded hover:bg-gray-50 hover:text-gray-700">
                                <i class='bx bx-edit'></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>