<div draggable="true"
    class="task-card my-2 bg-white border rounded p-2 shadow-sm hover:shadow-md text-sm transition-all duration-200"
    [class.scale-105]="task.isBeingDragged" [class.opacity-50]="task.isBeingDragged" draggable="true"
    (dragstart)="onDragStart($event)" (dragend)="onDragEnd($event)">
    <div class="flex justify-between items-start mb-2">
        <div class="flex items-center">
            <span [ngClass]="priorityClass()" class="px-1.5 py-0.5 rounded text-xs uppercase">{{ task.priority |
                enumLabel :'priority'}}</span>
            <i *ngIf="task.type==0" class="bx bx-task mx-1 py-1 text-[15px] text-blue-600"></i>
            <i *ngIf="task.type==1" class="bx bx-bug  mx-1 py-1 text-[15px] text-red-600 rotate-12"></i>
        </div>
        <div class="flex items-center ">
       <div
  class="flex items-center gap-1.5 px-2 py-1 rounded-md shadow-sm bg-white hover:bg-gray-100 transition-all border border-gray-200 text-xs font-medium text-gray-700"
>
  <span>AI</span>
  <svg
    class="w-4 h-4 text-yellow-500"
    viewBox="0 0 56 56"
    fill="currentColor"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M 26.6875 12.6602 C 26.9687 12.6602 27.1094 12.4961 27.1797 12.2383 C 27.9062 8.3242 27.8594 8.2305 31.9375 7.4570 C 32.2187 7.4102 32.3828 7.2461 32.3828 6.9648 C 32.3828 6.6836 32.2187 6.5195 31.9375 6.4726 C 27.8828 5.6524 28.0000 5.5586 27.1797 1.6914 C 27.1094 1.4336 26.9687 1.2695 26.6875 1.2695 C 26.4062 1.2695 26.2656 1.4336 26.1953 1.6914 C 25.3750 5.5586 25.5156 5.6524 21.4375 6.4726 C 21.1797 6.5195 20.9922 6.6836 20.9922 6.9648 C 20.9922 7.2461 21.1797 7.4102 21.4375 7.4570 C 25.5156 8.2774 25.4687 8.3242 26.1953 12.2383 C 26.2656 12.4961 26.4062 12.6602 26.6875 12.6602 Z M 15.3438 28.7852 C 15.7891 28.7852 16.0938 28.5039 16.1406 28.0821 C 16.9844 21.8242 17.1953 21.8242 23.6641 20.5821 C 24.0860 20.5117 24.3906 20.2305 24.3906 19.7852 C 24.3906 19.3633 24.0860 19.0586 23.6641 18.9883 C 17.1953 18.0977 16.9609 17.8867 16.1406 11.5117 C 16.0938 11.0899 15.7891 10.7852 15.3438 10.7852 C 14.9219 10.7852 14.6172 11.0899 14.5703 11.5352 C 13.7969 17.8164 13.4687 17.7930 7.0469 18.9883 C 6.6250 19.0821 6.3203 19.3633 6.3203 19.7852 C 6.3203 20.2539 6.6250 20.5117 7.1406 20.5821 C 13.5156 21.6133 13.7969 21.7774 14.5703 28.0352 C 14.6172 28.5039 14.9219 28.7852 15.3438 28.7852 Z M 31.2344 54.7305 C 31.8438 54.7305 32.2891 54.2852 32.4062 53.6524 C 34.0703 40.8086 35.8750 38.8633 48.5781 37.4570 C 49.2344 37.3867 49.6797 36.8945 49.6797 36.2852 C 49.6797 35.6758 49.2344 35.2070 48.5781 35.1133 C 35.8750 33.7070 34.0703 31.7617 32.4062 18.9180 C 32.2891 18.2852 31.8438 17.8633 31.2344 17.8633 C 30.6250 17.8633 30.1797 18.2852 30.0860 18.9180 C 28.4219 31.7617 26.5938 33.7070 13.9140 35.1133 C 13.2344 35.2070 12.7891 35.6758 12.7891 36.2852 C 12.7891 36.8945 13.2344 37.3867 13.9140 37.4570 C 26.5703 39.1211 28.3281 40.8321 30.0860 53.6524 C 30.1797 54.2852 30.6250 54.7305 31.2344 54.7305 Z"
    />
  </svg>
</div>



            <div class="dropdown dropdown-end">
                <div tabindex="0" role="button" class=" text-gray-400  hover:text-gray-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                    </svg>
                </div>
                <ul tabindex="0"
                    class="dropdown-content shadow-md menu bg-base-100 rounded-box z-1 w-52  border border-gray-100">


                    <a href="#"
                        class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 transition-all group">
                        <div
                            class="flex items-center justify-center w-8 h-8 bg-green-100 group-hover:bg-green-200 rounded-lg mr-3 transition-colors">
                            <i class='bx bx-paperclip text-green-600'></i>
                        </div>
                        <div>
                            <div class="font-medium">Attach File</div>
                            <div class="text-xs text-gray-500">Upload documents</div>
                        </div>
                    </a>

                    <a href="#"
                        class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-700 transition-all group">
                        <div
                            class="flex items-center justify-center w-8 h-8 bg-purple-100 group-hover:bg-purple-200 rounded-lg mr-3 transition-colors">
                            <i class='bx bx-image-add text-purple-600'></i>
                        </div>
                        <div>
                            <div class="font-medium">Add Image</div>
                            <div class="text-xs text-gray-500">Upload screenshots</div>
                        </div>
                    </a>

                    <hr class="my-2 border-gray-100">

                    <a href="#"
                        class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-all group">
                        <div
                            class="flex items-center justify-center w-8 h-8 bg-indigo-100 group-hover:bg-indigo-200 rounded-lg mr-3 transition-colors">
                            <i class='bx bx-detail text-indigo-600'></i>
                        </div>
                        <div>
                            <div class="font-medium">View Details</div>
                            <div class="text-xs text-gray-500">Full task information</div>
                        </div>
                    </a>
                </ul>
            </div>
        </div>
    </div>

    <h3 [ngClass]="{'line-through':task.status==3 , 'text-gray-700':task.status==3}"
        class="font-medium mb-1 line-clamp-2 text-gray-800">{{ task.title }}</h3>
    <p class="text-gray-600 text-xs mb-2 line-clamp-2">{{ task.description }}</p>

    <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
        <div class="flex items-center gap-2">
            <span *ngIf="task.sprintStartDate" class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                {{ task.sprintStartDate | date:'MMM d' }} - {{ task.sprintEndDate | date:'MMM dd' }}

            </span>
        </div>
        <div class="flex  ">
            <button (click)="openCommentModal(task.id)"
                class="flex items-center hover:text-blue-600  px-1 py-2 text-gray-600  transition-all duration-200">
                <i class='bx bx-comment text-sm'></i>
                <span class=" text-gray-800 text-xs font-medium px-1 py-0.5 rounded-full">
                    {{task.countComment}}
                </span>
            </button>
            <div class=" -space-x-3 flex">
                <div *ngFor="let user of task.assignedUsers; let i = index" class="relative group"
                    [style.z-index]="task.assignedUsers?.length ?? 0 - i">
                    <div class="w-7 h-7">
                        <img [src]="(user.image | memberImage )" [alt]="user.fullName" (error)="onImageError($event)"
                            class="w-full h-full rounded-full border-2 border-white shadow-sm hover:scale-110 transition-transform duration-200 cursor-pointer" />
                    </div>
                    <div
                        class="absolute bottom-full left-1/2 transform  -translate-x-1/2 mb-2 px-8 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none z-50">
                        {{ user.fullName }}
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>