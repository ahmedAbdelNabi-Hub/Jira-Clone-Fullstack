<div class="min-h-screen bg-[#fcfbfb] p-4">
    <!-- Header -->
    <div class="mb-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <app-filters (filtersChanged)="onFiltersChanged($event)"></app-filters>
            <div class="flex items-center gap-4">
                <!-- Task Count and Add Button -->
                <div class="flex items-center gap-2">
                    <div class="bg-white px-3 py-1.5 rounded shadow-sm border text-sm">
                        <span class="text-gray-600">Tasks: </span>
                        <span class="font-medium">{{ todoTasks.length + inProgressTasks.length + doneTasks.length
                            }}</span>
                    </div>
                    <button (click)="showDialog('right')"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded text-sm font-medium">
                        + Add Task
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Kanban Board -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

        <app-kanban-column (openCommend)="OpenCommendModal()" title="To Do" status="todo" [tasks]="todoTasks()"
            [dragOverColumn]="dragOverColumn()" (dropTask)="onDrop($event, 0)"
            (dragStart)="onDragStart($event.event, $event.task)" (dragEnd)="onDragEnd($event)"
            (dragEnter)="onDragEnter($event, 'todo')" (dragLeave)="onDragLeave($event)" (dragOver)="onDragOver($event)">
        </app-kanban-column>

        <app-kanban-column title="In Progress" status="inprogress" [tasks]="inProgressTasks()"
            [dragOverColumn]="dragOverColumn()" (dropTask)="onDrop($event, 1)"
            (dragStart)="onDragStart($event.event, $event.task)" (dragEnd)="onDragEnd($event)"
            (dragEnter)="onDragEnter($event, 'inprogress')" (dragLeave)="onDragLeave($event)"
            (dragOver)="onDragOver($event)">
        </app-kanban-column>

        <app-kanban-column title="In Review" status="inreview" [tasks]="reviewTasks()"
            [dragOverColumn]="dragOverColumn()" (dropTask)="onDrop($event, 2)"
            (dragStart)="onDragStart($event.event, $event.task)" (dragEnd)="onDragEnd($event)"
            (dragEnter)="onDragEnter($event, 'inreview')" (dragLeave)="onDragLeave($event)"
            (dragOver)="onDragOver($event)">
        </app-kanban-column>

        <app-kanban-column title="Done" status="done" [tasks]="doneTasks()" [dragOverColumn]="dragOverColumn()"
            (dropTask)="onDrop($event, 3)" (dragStart)="onDragStart($event.event, $event.task)"
            (dragEnd)="onDragEnd($event)" (dragEnter)="onDragEnter($event, 'done')" (dragLeave)="onDragLeave($event)"
            (dragOver)="onDragOver($event)">
        </app-kanban-column>

    </div>

    <p-drawer [style]="{ width: '37rem', height: '100%' }" header="New Task" [(visible)]="visible" position="right">
        <app-task-form></app-task-form>
    </p-drawer>
</div>

<app-comment-modal [isModalOpen]="isCommendModalOpen" [comments]="taskComments" [currentUser]="currentUserName"
    (commentAdded)="onCommentAdded($event)">
</app-comment-modal>